<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Remoscope / {{ dataset_name }}</title>
        <h1 style="text-align: center;">RESEARCH USE ONLY - <strong>NOT FOR CLINICAL USE</strong></h1>
        <link href="{{ css_file }}" rel="stylesheet" type="text/css">
    </head>

    <h1>Remoscope / Dataset {{ dataset_name }} </h1>
    <body>
        <h2>Statistics summary and thumbnails</h2>

        {# Experiment metadata #}
        <table style="table-layout: fixed;">
            <thead>
                <tr>
                    <th colspan="2">Experiment metadata</th>
                </tr>
            </thead>
            <tr>
                <td>Operator ID</td>
                <td>{{ operator_id }}</td>
            </tr>
            <tr>
                <td>Non-identifying participant ID</td>
                <td>{{ participant_id }}</td>
            </tr>
            <tr>
                <td>Notes</td>
                <td><p style="word-wrap: break-word; -pdf-word-wrap: CJK;">{{ notes }}</p></td>
            </tr>
            <tr>
                <td>Flowcell ID</td>
                <td>{{ flowcell_id }}</td>
            </tr>

            {# Cell counts #}
            <thead>
                <tr>
                    <th colspan="2">Cell counts</th>
                </tr>
            </thead>
            {% for key in cell_counts %}
            <tr>
                <td>{{key}}</td>
                <td>{{cell_counts[key]}}</td>
            </tr>
            {% endfor %}
            <tr>
                <td>% Parasitemia<br><strong>(NOT FOR CLINICAL USE)</strong></td>
                <td>{{perc_parasitemia}}%</td>
            </tr>
        </table>

        {# Thumbnails #}
        <h3>Parasite thumbnails</h3>
        <table>
            {% for key in all_thumbnails %}
                <thead>
                    <tr>
                        <th colspan="10">{{key.upper()}}</th>
                    </tr>
                </thead>
                {% for row in all_thumbnails[key]|batch(10, "") %}
                <tr>
                    {% for filename in row %}
                    <td>
                        {% if filename | length > 0 %}
                            <img src="{{ filename }}">
                            <p>{{".".join(filename.split("_")[-1].split(".")[:2])}}</p>
                        {% endif %}
                    </td>
                    {% endfor %}
                </tr>
                {% endfor %}
            {% endfor %}
        </table>
        
        {# OPTIONAL PLOTS FOR INTERNAL USE #}
        {% if DEBUG_SUMMARY_REPORT %}
            {# Metadata plots #}
            <h3>Per-Image Metadata Plot</h3>
            <img src = "{{per_image_metadata_plot_filename}}">

            {# YOGO Performance Plots #}
            <h3>YOGO Performance Plots</h3>
            <h4>Cell counts over time</h4>
            <img src = "{{cell_count_plot_filename}}">
            <br>
            <h4>Confidence histograms</h4>
            <aside>Model confidences <strong>DO NOT</strong> correspond to an actual probability distribution.</aside>
            <img src = "{{confidence_hists_filename}}">
            <br>
            <h4>Objectness histograms</h4>
            <img src = "{{objectness_hists_filename}}">
        {% endif %}
    </body>
</html>